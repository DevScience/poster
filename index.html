<!DOCTYPE html>
<html lang="es">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Galería COINSI 2025 + Final Épico</title>
	<!-- Inclusión de Tailwind CSS -->
	<script src="https://cdn.tailwindcss.com"></script>
	<style>
		/* Estilo para la fuente Inter */
		body {
			font-family: 'Inter', sans-serif;
			overflow-x: hidden;
		}
		/* Estilos para el modal */
		.modal-backdrop {
			transition: opacity 0.3s ease;
		}
		.modal-content {
			transition: transform 0.3s ease;
		}
		
		/* --- IMAGEN DE BANNER --- */
		.hero-banner {
			background-image: url('https://raw.githubusercontent.com/DevScience/poster/main/coinsi2025.png');
			background-size: cover;
			background-position: center center;
		}
		
		/* Sombra suave personalizada para las tarjetas */
		.card-shadow {
			box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
		}
		.card-shadow:hover {
			box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
		}

		/* Animación sutil para la copa */
		@keyframes shine {
			0% { transform: scale(1); filter: brightness(100%); }
			50% { transform: scale(1.1); filter: brightness(120%); }
			100% { transform: scale(1); filter: brightness(100%); }
		}
		.trophy-icon {
			animation: shine 3s infinite ease-in-out;
		}

		/* --- ESTILOS ZERG RUSH --- */
		.zergling {
			position: absolute;
			border-radius: 50%;
			cursor: crosshair;
			z-index: 9999;
			box-shadow: 0 2px 5px rgba(0,0,0,0.2);
			display: flex;
			align-items: center;
			justify-content: center;
			font-weight: bold;
			font-size: 10px;
			color: rgba(255,255,255,0.9);
			user-select: none;
			border: 2px solid white;
			/* OPTIMIZACIÓN CRÍTICA: Quitamos left/top de la transición por defecto para evitar LAG */
			transition: transform 0.05s, opacity 0.1s, background-color 0.5s ease, width 0.5s ease, height 0.5s ease;
		}
		
		/* Clase especial que se añade SOLO al final para que se muevan suavemente a formar el texto */
		.zergling.formation {
			transition: left 1.5s cubic-bezier(0.34, 1.56, 0.64, 1), top 1.5s cubic-bezier(0.34, 1.56, 0.64, 1), background-color 1s ease, width 1s ease, height 1s ease;
		}

		.zergling.type-y { background-color: #fbbc05; }
		.zergling.type-r { background-color: #ea4335; }
		.zergling.type-tank { background-color: #a105fb; border-color: #ffd700; }

		/* Efecto de golpe */
		.zergling.hit {
			filter: brightness(200%);
			transform: scale(0.95);
		}
		
		/* HUD del juego */
		#zerg-hud {
			position: fixed;
			top: 20px;
			right: 20px;
			background: rgba(15, 23, 42, 0.95);
			color: white;
			padding: 15px;
			border-radius: 12px;
			z-index: 10000;
			display: none;
			font-family: monospace;
			border: 1px solid #334155;
			box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.5);
			backdrop-filter: blur(4px);
			min-width: 200px;
		}
		.hud-stat {
			display: flex;
			justify-content: space-between;
			margin-bottom: 6px;
			font-size: 0.9rem;
		}

		/* Mensaje final (Overlay) */
		#end-message {
			position: fixed;
			inset: 0;
			display: flex;
			flex-direction: column;
			align-items: center;
			justify-content: center; /* Centrado vertical base */
			z-index: 9998;
			opacity: 0;
			transition: opacity 2s ease-in-out;
			pointer-events: none;
			background: rgba(255, 255, 255, 0.92); /* Fondo sólido limpio */
			backdrop-filter: blur(8px);
			padding-top: 180px; /* Espacio superior reservado para la palabra COINSI */
		}
		/* Animación de entrada suave para el texto final */
		.end-text-anim {
			animation: fadeInUp 1.5s ease-out forwards;
		}
		@keyframes fadeInUp {
			from { opacity: 0; transform: translateY(40px); }
			to { opacity: 1; transform: translateY(0); }
		}
	</style>
	<!-- Importar la fuente Inter de Google Fonts -->
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
</head>
<body class="bg-slate-50 text-slate-800 relative">

	<!-- HUD del Juego -->
	<div id="zerg-hud">
		<div class="text-lg font-extrabold text-red-500 mb-3 border-b border-slate-600 pb-2 flex justify-between items-center">
			ZERG RUSH
			<span class="text-[10px] bg-red-900 text-red-100 px-1.5 py-0.5 rounded border border-red-700">ELITE</span>
		</div>
		<div class="hud-stat text-slate-300"><span>Puntos:</span> <span id="score-val" class="text-emerald-400 font-bold font-mono">0</span></div>
		<div class="hud-stat text-slate-300"><span>Nivel:</span> <span id="level-val" class="text-amber-400 font-bold font-mono">1</span></div>
		<div class="hud-stat text-slate-300"><span>Enemigos:</span> <span id="count-val" class="text-white font-mono">0</span>/<span id="max-zerg-val">9</span></div>
		
		<div class="mt-4 pt-3 border-t border-slate-600">
			<div class="text-[10px] text-slate-400 mb-2 uppercase tracking-wider font-semibold text-center">Misión: Defender el Footer</div>
			<button onclick="location.reload()" class="w-full py-2 bg-red-600 hover:bg-red-700 text-white text-xs rounded shadow transition-colors font-bold uppercase tracking-wide">
				Reiniciar
			</button>
		</div>
	</div>

	<!-- Mensaje final Centrado (Desplazado hacia abajo por padding-top) -->
	<div id="end-message">
		<h1 class="text-3xl md:text-6xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-indigo-600 to-purple-600 mb-4 drop-shadow-sm text-center leading-tight px-4">Fue una buena experiencia</h1>
		<p class="text-xl md:text-3xl text-slate-600 font-light text-center">¡Nos vemos en COINSI 2026!</p>
	</div>

	<!-- Encabezado -->
	<header class="hero-banner w-full relative text-white target-element">
		<div class="absolute inset-0 bg-slate-900 bg-opacity-80 backdrop-blur-[2px]"></div>
		<div class="container mx-auto px-6 text-center relative z-10 py-24">
			<h1 class="text-4xl sm:text-5xl font-extrabold text-white tracking-tight drop-shadow-sm target-element">Galería de Pósters Científicos</h1>
			<p class="text-xl text-slate-200 mt-4 font-light target-element">Explora los trabajos presentados en COINSI 2025</p>
		</div>
	</header>

	<!-- Contenido Principal -->
	<div class="container mx-auto px-6 py-12 relative">

		<!-- Imagen de Resultados -->
		<div class="mb-10 flex justify-center target-element">
			<img src="https://raw.githubusercontent.com/DevScience/poster/main/resultscoinsi2025.jpg" alt="Resultados COINSI 2025" class="w-full max-w-4xl rounded-xl shadow-lg border border-slate-200">
		</div>
		
		<!-- Buscador Centrado -->
		<div class="mb-6">
			<div class="relative max-w-2xl mx-auto group target-element">
				<div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
					<svg class="w-5 h-5 text-slate-400 group-focus-within:text-indigo-500 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
				</div>
				<input
					type="text"
					id="search-input"
					placeholder="Buscar por título, autor o palabras clave..."
					class="w-full pl-12 p-4 border border-slate-200 rounded-full shadow-sm focus:outline-none focus:ring-4 focus:ring-indigo-100 focus:border-indigo-500 transition-all duration-300 text-lg bg-white placeholder-slate-400"
				/>
			</div>
		</div>

		<!-- Botón para iniciar el juego -->
		<div class="mb-16 text-center">
			<button onclick="startZergRush()" id="start-zerg-btn" class="group relative inline-flex items-center justify-center px-8 py-3 text-sm font-bold text-white transition-all duration-200 bg-red-600 font-pj rounded-full focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-600 hover:bg-red-700 shadow-lg hover:shadow-red-500/50 overflow-hidden">
				<span class="absolute inset-0 w-full h-full -mt-1 rounded-lg opacity-30 bg-gradient-to-b from-transparent via-transparent to-black"></span>
				<span class="relative flex items-center gap-2 uppercase tracking-widest">
					⚠️ Iniciar Zerg Rush
				</span>
			</button>
		</div>

		<!-- Sección PROYECTOS TERMINADOS -->
		<section class="mb-20 target-element-container">
			<div class="flex items-center justify-between mb-8 border-b border-slate-200 pb-4 target-element">
				<h2 id="title-terminados" class="text-2xl font-bold text-slate-800 flex items-center gap-3">
					<span class="w-2 h-8 bg-indigo-600 rounded-full"></span>
					Proyectos Terminados
				</h2>
				<span class="text-sm font-medium text-slate-500 bg-slate-100 px-3 py-1 rounded-full" id="count-terminados">0 proyectos</span>
			</div>
			
			<div id="proyectos-terminados-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-8"></div>
			
			<div id="no-results-terminados" class="hidden text-center py-12 bg-white rounded-2xl border border-dashed border-slate-300">
				<p class="text-slate-500 text-lg">No se encontraron proyectos terminados.</p>
			</div>
		</section>

		<!-- Sección PROYECTOS EN DESARROLLO -->
		<section class="mb-16 target-element-container">
			<div class="flex items-center justify-between mb-8 border-b border-slate-200 pb-4 target-element">
				<h2 id="title-desarrollo" class="text-2xl font-bold text-slate-800 flex items-center gap-3">
					<span class="w-2 h-8 bg-amber-500 rounded-full"></span>
					Proyectos en Desarrollo
				</h2>
				<span class="text-sm font-medium text-slate-500 bg-slate-100 px-3 py-1 rounded-full" id="count-desarrollo">0 proyectos</span>
			</div>
			
			<div id="proyectos-desarrollo-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-8"></div>
			
			<div id="no-results-desarrollo" class="hidden text-center py-12 bg-white rounded-2xl border border-dashed border-slate-300">
				<p class="text-slate-500 text-lg">No se encontraron proyectos en desarrollo.</p>
			</div>
		</section>

	</div>

	<!-- Modal Imagen -->
	<div id="image-modal" class="fixed inset-0 bg-slate-900/90 backdrop-blur-sm flex items-center justify-center p-4 z-50 hidden modal-backdrop opacity-0" onclick="closeModal()">
		<div class="bg-white rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-auto modal-content transform scale-95 transition-all" onclick="event.stopPropagation()">
			<div class="sticky top-0 z-10 flex justify-between items-center px-6 py-4 bg-white/95 backdrop-blur border-b border-slate-100">
				<h2 id="modal-title" class="text-lg font-semibold text-slate-800 truncate pr-4"></h2>
				<button onclick="closeModal()" class="p-2 hover:bg-slate-100 rounded-full transition-colors">
					<svg class="w-6 h-6 text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
				</button>
			</div>
			<div class="p-4 bg-slate-50 flex justify-center">
				<img id="modal-image" src="" alt="Póster" class="max-w-full h-auto rounded shadow-lg">
			</div>
		</div>
	</div>

	<!-- Modal PDF -->
	<div id="pdf-modal" class="fixed inset-0 bg-slate-900/90 backdrop-blur-sm flex items-center justify-center p-4 z-50 hidden modal-backdrop opacity-0" onclick="closePdfModal()">
		<div class="bg-white rounded-xl shadow-2xl max-w-6xl w-full h-[90vh] flex flex-col modal-content transform scale-95 transition-all" onclick="event.stopPropagation()">
			<div class="flex justify-between items-center px-6 py-4 border-b border-slate-100">
				<h2 id="pdf-modal-title" class="text-lg font-semibold text-slate-800 truncate pr-4"></h2>
				<button onclick="closePdfModal()" class="p-2 hover:bg-slate-100 rounded-full transition-colors">
					<svg class="w-6 h-6 text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
				</button>
			</div>
			<div class="flex-grow bg-slate-100 relative">
				<iframe id="pdf-frame" src="about:blank" class="w-full h-full border-none" title="Visor PDF"></iframe>
			</div>
		</div>
	</div>

	<!-- Footer (ELEMENTO OBJETIVO FINAL - ID: main-footer) -->
	<footer id="main-footer" class="bg-white text-slate-500 text-center py-10 mt-12 border-t border-slate-200 target-element relative z-10">
		<p class="text-sm font-medium">&copy; 2025 COINSI. Innovación y Ciencia.</p>
	</footer>

	<script>
		// --- Paletas de Color UX Modernas ---
		const modernPalettes = [
			{ name: 'Indigo', hex: '6366f1', bg: 'bg-indigo-50/50', border: 'border-indigo-100', text: 'text-indigo-900', accent: 'text-indigo-600', badge: 'bg-indigo-100 text-indigo-700' },
			{ name: 'Emerald', hex: '10b981', bg: 'bg-emerald-50/50', border: 'border-emerald-100', text: 'text-emerald-900', accent: 'text-emerald-600', badge: 'bg-emerald-100 text-emerald-700' },
			{ name: 'Rose', hex: 'f43f5e', bg: 'bg-rose-50/50', border: 'border-rose-100', text: 'text-rose-900', accent: 'text-rose-600', badge: 'bg-rose-100 text-rose-700' },
			{ name: 'Sky', hex: '0ea5e9', bg: 'bg-sky-50/50', border: 'border-sky-100', text: 'text-sky-900', accent: 'text-sky-600', badge: 'bg-sky-100 text-sky-700' },
			{ name: 'Amber', hex: 'f59e0b', bg: 'bg-amber-50/50', border: 'border-amber-100', text: 'text-amber-900', accent: 'text-amber-600', badge: 'bg-amber-100 text-amber-800' },
			{ name: 'Violet', hex: '8b5cf6', bg: 'bg-violet-50/50', border: 'border-violet-100', text: 'text-violet-900', accent: 'text-violet-600', badge: 'bg-violet-100 text-violet-700' },
			{ name: 'Teal', hex: '14b8a6', bg: 'bg-teal-50/50', border: 'border-teal-100', text: 'text-teal-900', accent: 'text-teal-600', badge: 'bg-teal-100 text-teal-700' },
			{ name: 'Slate', hex: '64748b', bg: 'bg-slate-50/50', border: 'border-slate-200', text: 'text-slate-800', accent: 'text-slate-600', badge: 'bg-slate-200 text-slate-700' }
		];

		// --- Datos ---
		const rawPosters = [
			// --- TERMINADOS ---
			{
				titulo: "COMPARACIÓN Y APLICACIÓN DE MODELOS DE INTELIGENCIA ARTIFICIAL PARA LA DETECCIÓN DE URLS DE PHISHING EN UNA EXTENSIÓN WEB",
				autor: "Ivan Condori; Christian Ticona; Rosario Bustamante",
				imagenUrl: "https://placehold.co/400x600?text=Póster+Id02",
				pdfUrl: "https://drive.google.com/file/d/1QRHjJDI2bw0n6oWJaO8GjlqURfMHnC5i/view",
				videoUrl: "https://drive.google.com/file/d/1OFMcV6dmqbQJ9tKn2bolGLRD7qDlOm8S/view",
				categoria: 'terminado'
			},
			{
				titulo: "EVALUACIÓN DE MODELOS DE MACHINE LEARNING PARA DETECTAR MALWARE EN ARCHIVOS EJECUTABLES",
				autor: "Diego B. Apaza Phocco; Masaharu R. Watanabe Valdivia",
				imagenUrl: "https://placehold.co/400x600?text=Póster+Id08",
				pdfUrl: "https://drive.google.com/file/d/1yvLc6j4pEDwSzq64LXrclb1xu_ftORZo/view",
				videoUrl: "https://drive.google.com/file/d/1FPYjIjZHGBHJQYMPMr_IL8RRPX73-S7U/view",
				categoria: 'terminado'
			},
			{
				titulo: "VISIÓN COMPUTACIONAL PARA LA CLASIFICACIÓN AUTOMÁTICA DE LA OCA EN LA ZONA SUR DE LA REGIÓN PUNO",
				autor: "Andreas J. Quispe",
				imagenUrl: "https://placehold.co/400x600?text=Póster+Id10",
				pdfUrl: "https://drive.google.com/file/d/16GEQNJQP3bChwC0vCc3f6iIC14929-qm/view",
				videoUrl: "https://drive.google.com/file/d/1gYtVvgc2HAxvpxz0wrNKWUDGKQEqp-us/view",
				categoria: 'desarrollo'
			},
			{
				titulo: "CLASIFICACIÓN AUTOMATIZADA DE LESIONES CUTÁNEAS MEDIANTE MOBILENETV2 CON TRANSFER LEARNING PARA APOYO EN DEMATOLOGÍA",
				autor: "Jhon M. Aracayo Mamani; Juan D. Canaza Paucara; Mayenka Fernandez Chambi",
				imagenUrl: "https://placehold.co/400x600?text=Póster+Id13",
				pdfUrl: "https://drive.google.com/file/d/1XyEZp0b5ZYo4cHsoiAxf-nWv7VHyleh0/view",
				videoUrl: "https://drive.google.com/file/d/1CA1_uF_vCI1GBAxh1UAuygwX_LZ5gQgA/view",
				categoria: 'terminado'
			},
			{
				titulo: "MODELO PREDICTIVO DEL TIMPANISMO EN OVINOS DE LA PROVINCIA DE EL COLLAO – ILAVE",
				autor: "Vanessa Y. Castro Ccallo; Zulema L. Mamani Huacani",
				imagenUrl: "https://placehold.co/400x600?text=Póster+Id15",
				pdfUrl: "https://drive.google.com/file/d/1PAKWI73Y72c1XZsOqVRzXovZQWQ9nuY5/view",
				videoUrl: "https://drive.google.com/file/d/1RkeLIj2GP56CWU7IFnkxCi8Qw5Tfifq9/view",
				categoria: 'desarrollo'
			},
			{
				titulo: "SISTEMA WEB INTELIGENTE DE GESTIÓN Y OPTIMIZACIÓN OPERATIVA PARA EL SERENAZGO DE LA MUNICIPALIDAD PROVINCIAL DE PUNO",
				autor: "Carlos M. Angles Quispe; Mayenka Fernandez Chambi",
				imagenUrl: "https://placehold.co/400x600?text=Póster+Id16",
				pdfUrl: "https://drive.google.com/file/d/1RYwWW7g_1EpYAXDEvnRQjb4qebMpp0Q_/view",
				videoUrl: "https://drive.google.com/file/d/1yOXlGfLn3KdoauCIqsoKeFFmPHSa6qcO/view",
				categoria: 'desarrollo'
			},
			{
				titulo: "MODELO CNN PARA DETECCIÓN DE ENFERMEDADES EN HOJAS DE ALFALFA (MEDICAGO SATIVA L.) EN UNA PARCELA AGRÍCOLA DEL DISTRITO DE AZÁNGARO.",
				autor: "Jack B. Cancapa Pacco",
				imagenUrl: "https://placehold.co/400x600?text=Póster+Id17",
				pdfUrl: "https://drive.google.com/file/d/1w3MDpuxmbZ4_wIsp1JtXj9hnm7Gcxydj/view",
				videoUrl: "https://drive.google.com/file/d/1NiuZDzv6HoNX81bw3JOFxfqa8biqv_V_/view",
				categoria: 'desarrollo'
			},
			{
				titulo: "EVALUACIÓN DE ARQUITECTURAS DE APRENDIZAJE PROFUNDO PARA LA PREDICCIÓN CLIMÁTICA DE HELADAS EN PUNO USANDO DATOS SATELITALES MERRA-2",
				autor: "Ludwin J. D. Cheje Apaza; Jhoel L. Condori Quispe",
				imagenUrl: "https://placehold.co/400x600?text=Póster+Id20",
				pdfUrl: "https://drive.google.com/file/d/1ZJINNvr_458Gg1UOdSJetezvUcQR_2Ay/view",
				videoUrl: "https://drive.google.com/file/d/1efZimg3rlCDP_Xnsb-aCOM7Y93qn36pn/view",
				categoria: 'terminado',
				premio: true
			},
			{
				titulo: "NAIVE BAYES Y DATOS LIKERT: SUPERIORIDAD DEL ONE-HOT ENCODING EN LA PREDICCIÓN DE SATISFACCIÓN ESTUDIANTIL",
				autor: "Alexis Aguilar Vilca; José Luis Juarez Ruelas",
				imagenUrl: "https://placehold.co/400x600?text=Póster+Id27",
				pdfUrl: "https://drive.google.com/file/d/1xuJ992kunfrryDAJNMGJkjx6mSIcmaQc/view",
				videoUrl: "https://drive.google.com/file/d/1XB7_9mToDNnzcdcZTiz4Kb9bcYWli8k9/view",
				categoria: 'terminado'
			},
			{
				titulo: "COMPARATIVA DE MODELOS PROFUNDOS PARA DETECTAR EMOCIONES FACIALES",
				autor: "Elmer R. Incacutipa Huarachi; Eli R. Quispe Ticona",
				imagenUrl: "https://placehold.co/400x600?text=Póster+Id28",
				pdfUrl: "https://drive.google.com/file/d/16gPIEiQJLDOvqo91zHbV6jm8n_dxl3-y/view",
				videoUrl: "https://drive.google.com/file/d/1RFeCFgoBI4lTGmy5O32UMbh7llkcwGO8/view",
				categoria: 'terminado'
			},
			// --- DESARROLLO ---
			{
				titulo: "GAMIFICACIÓN Y RETROALIMENTACIÓN FORMATIVA EN UNA APLICACIÓN EDUCATIVA MÓVIL PARA FORTALECER LA COMPRENSIÓN LECTORA EN ESTUDIANTES DE PRIMARIA EN ZONAS RURALES",
				autor: "Sandra Mamani Condemayta; Rogger Humpiri Flores",
				imagenUrl: "https://placehold.co/400x600?text=Póster+Id30",
				pdfUrl: "https://drive.google.com/file/d/1IsgL5MDzfSVOyd-0mWn_ptnycn0kDz-M/view",
				videoUrl: "https://drive.google.com/file/d/1fSnE5CbeYwcySLjY70vGnZLeEJL5VURl/view",
				categoria: 'desarrollo'
			},
			{
				titulo: "APLICACIÓN MÓVIL GAMIFICADA CON MICROLEARNING PARA MEJORAR EL NIVEL DE CONOCIMIENTO EN CIBERSEGURIDAD EN ESTUDIANTES DE NIVEL SECUNDARIA",
				autor: "Mery L. Paredes Arcaya",
				imagenUrl: "https://placehold.co/400x600?text=Póster+Id35",
				pdfUrl: "https://drive.google.com/file/d/1pPQxN5Dzp3v-cYK-FtnOD43x5rDO45yM/view",
				videoUrl: "https://drive.google.com/file/d/1Yh-X1Nfo8TEYppJ5xL8PqjsKzA-rgxst/view",
				categoria: 'desarrollo'
			},
			{
				titulo: "DISEÑO E IMPLEMENTACIÓN DE UN SISTEMA AUTOMATIZADO DE GESTIÓN DE LA INFORMACIÓN PARA LA VERIFICACIÓN DE LA MATRIZ DE CONSISTENCIA",
				autor: "Angie T. Luque Pacheco",
				imagenUrl: "https://placehold.co/400x600?text=Póster+Id36",
				pdfUrl: "https://drive.google.com/file/d/1wzH3FAz3JYLjcDr8Oocmlgrt6zsdFuBT/view",
				videoUrl: "https://drive.google.com/file/d/1T8IcxpHAVtvq3QlWHVs-PumjZYLVlndi/view",
				categoria: 'desarrollo'
			},
			{
				titulo: "MODELO DE RECONOCIMIENTO ÓPTICO DE MARCAS PARA EVALUACIONES A GRAN ESCALA",
				autor: "Adderly Mendoza Nina",
				imagenUrl: "https://placehold.co/400x600?text=Póster+Id38",
				pdfUrl: "https://drive.google.com/file/d/1782-ybkQ7dXbPgJq5d6LwNWbo3waBhg2/view",
				videoUrl: "https://drive.google.com/file/d/1hEVqGbI8LENOG_QhYXN7kA0BMikVKXcG/view",
				categoria: 'terminado'
			},
			{
				titulo: "DE DATOS A DECISIONES: ALGORITMOS DE BOOSTING APLICADOS A PREDICCIÓN DE DEMANDA EN FASHION RETAIL",
				autor: "Elmer Luque Condori; José Luis Juarez Ruelas",
				imagenUrl: "https://placehold.co/400x600?text=Póster+Id40",
				pdfUrl: "https://drive.google.com/file/d/1zZ25BET5valdEWECYfAjh_GpCVu68FCU/view",
				videoUrl: "https://drive.google.com/file/d/1tWiHFL2kpQEtKp3L4ua5b-ZR0iYLWr9z/view",
				categoria: 'desarrollo'
			},
			{
				titulo: "DETECCIÓN DE PHISHING CON MODELO HIBRIDO: COMBINANDO TEXTO Y URL",
				autor: "Aaron R. Vilca Cari",
				imagenUrl: "https://placehold.co/400x600?text=Póster+Id41",
				pdfUrl: "https://drive.google.com/file/d/1_Rqwe1z8NmBhiufivR2nplR03_RFe1X8/view",
				videoUrl: "https://drive.google.com/file/d/1UPZ9Ps1w9fd7UYHIC7iUblkMxDe5iAj2/view",
				categoria: 'terminado'
			},
			{
				titulo: "SISTEMA INTELIGENTE DE OPTIMIZACIÓN DE RUTAS PARA RECOLECCIÓN DE RESIDUOS SÓLIDOS URBANOS MEDIANTE DEEP LEARNING Y ALGORITMOS HEURÍSTICOS: CASO PUNO, PERÚ",
				autor: "Brayam V. Ramirez Vidal; York R. Apaza Tacca",
				imagenUrl: "https://placehold.co/400x600?text=Póster+Id42",
				pdfUrl: "https://drive.google.com/file/d/1RPclJG9C6wNuhViYQgYScqvNLDpWC8XZ/view",
				videoUrl: "https://drive.google.com/file/d/1KWJK1d7OLTOqD64NBGmxs2t9u-CCkg-Z/view",
				categoria: 'desarrollo'
			},
			{
				titulo: "EFECTO DEL REDIMENSIONAMIENTO PROGRESIVO EN REDES NEURONALES CONVOLUCIONALES PARA LA DETECCIÓN DE NEUMONÍA EN RADIOGRAFÍAS DE TÓRAX",
				autor: "Milton H. Taco Aviles; Jhyna S. Ccama Itusaca",
				imagenUrl: "https://placehold.co/400x600?text=Póster+Id43",
				pdfUrl: "https://drive.google.com/file/d/1y-e4pSmpy1cTj-MsSEsJiUW-ADZCKq1v/view",
				videoUrl: "https://drive.google.com/file/d/1xbJCFiw4KuQdzR9dfsOygpDLyCcC2s94/view",
				categoria: 'desarrollo',
				premio: true
			},
			{
				titulo: "ACELERANDO LA ADAPTACIÓN DE DOMINIO MEDIANTE NAIVE BAYES-AG: UN ENFOQUE PARA LA CLASIFICACIÓN EFICIENTE EN ENTORNOS DE APRENDIZAJE POR TRANSFERENCIA",
				autor: "Oscar A. Cari Yana",
				imagenUrl: "https://placehold.co/400x600?text=Póster+Id46",
				pdfUrl: "https://drive.google.com/file/d/1ZPracCE9gRjZoh_YlHKeXhUFJ7wUIQB7/view",
				videoUrl: "https://drive.google.com/file/d/1k3uio4-dxJ__3muQA6WQCgLYfiW2H_AA/view",
				categoria: 'terminado'
			},
			{
				titulo: "MODELO HÍBRIDO SS-LGBM: DETECCIÓN OPTIMIZADA DE ATAQUES MINORITARIOS CON SMOTE ESTRATÉGICO Y ENSAMBLES DE ÁRBOLES",
				autor: "Carmen N. Apaza Condori",
				imagenUrl: "https://placehold.co/400x600?text=Póster+Id48",
				pdfUrl: "https://drive.google.com/file/d/1V-I_XuM6mue5NWYHPGhbKqQ3e0trhcJj/view",
				videoUrl: "https://drive.google.com/file/d/1r5KtGm4S0xeGtA4AK-qXE3I1PfskopHw/view",
				categoria: 'terminado'
			}
		];

		// --- Inicialización de Datos con Color y URL dinámica ---
		const posters = rawPosters.map(poster => {
			const theme = modernPalettes[Math.floor(Math.random() * modernPalettes.length)];
			let dynamicImage = poster.imagenUrl;
			if (dynamicImage.includes('placehold.co')) {
				const parts = dynamicImage.split('?');
				const query = parts[1] ? `?${parts[1]}` : '';
				dynamicImage = `https://placehold.co/400x250/${theme.hex}/FFFFFF${query}&font=montserrat`;
			}
			return { ...poster, theme: theme, finalImage: dynamicImage };
		});

		// --- Elementos DOM ---
		const searchInput = document.getElementById('search-input');
		const completedGrid = document.getElementById('proyectos-terminados-grid');
		const developmentGrid = document.getElementById('proyectos-desarrollo-grid');
		const noResultsTerminados = document.getElementById('no-results-terminados');
		const noResultsDesarrollo = document.getElementById('no-results-desarrollo');
		const countTerminadosEl = document.getElementById('count-terminados');
		const countDesarrolloEl = document.getElementById('count-desarrollo');
		const modal = document.getElementById('image-modal');
		const modalImage = document.getElementById('modal-image');
		const modalTitle = document.getElementById('modal-title');
		const pdfModal = document.getElementById('pdf-modal');
		const pdfFrame = document.getElementById('pdf-frame');
		const pdfModalTitle = document.getElementById('pdf-modal-title');

		// --- Renderizado de Tarjeta ---
		function createPosterCard(poster) {
			const theme = poster.theme;
			const card = document.createElement('div');
			
			card.className = `
				bg-white rounded-2xl overflow-hidden border border-slate-100 card-shadow
				flex flex-col h-full transform transition-all duration-300 hover:-translate-y-1
				target-element poster-card
			`;

			const hasPdf = poster.pdfUrl ? true : false;
			const hasVideo = poster.videoUrl && poster.videoUrl !== '#' ? true : false;

			const awardBadge = poster.premio ? `
				<div class="absolute top-3 left-3 z-20 bg-yellow-50 border border-yellow-200 text-yellow-600 px-2 py-1 rounded-lg shadow-sm flex items-center gap-1.5 backdrop-blur-sm bg-opacity-90">
					<svg class="w-4 h-4 fill-yellow-500 text-yellow-600 trophy-icon" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
						<path d="M10 2a.75.75 0 01.75.75v.5h.5a2.75 2.75 0 012.75 2.75v.5c0 .88-.396 1.67-1.025 2.216A4.75 4.75 0 0110.75 12.5V15h1.75a.75.75 0 010 1.5h-5a.75.75 0 010-1.5h1.75v-2.5A4.75 4.75 0 017.025 8.766 2.753 2.753 0 016 6.5v-.5A2.75 2.75 0 018.75 3.25h.5v-.5A.75.75 0 0110 2z" />
					</svg>
					<span class="text-[10px] font-bold uppercase tracking-wider">Ganador</span>
				</div>
			` : '';

			card.innerHTML = `
				<div class="relative h-48 overflow-hidden group cursor-pointer" onclick="openModal('${poster.finalImage}', '${poster.titulo}')">
					<img src="${poster.finalImage}" alt="${poster.titulo}" class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105" onerror="this.src='https://placehold.co/400x250/cbd5e1/ffffff?text=Sin+Imagen'">
					<div class="absolute inset-0 bg-gradient-to-t from-black/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
					
					<div class="absolute top-3 right-3 z-10">
						<span class="px-2 py-1 text-[10px] font-bold uppercase tracking-widest bg-white/90 backdrop-blur text-slate-700 rounded shadow-sm">
							${poster.categoria === 'terminado' ? 'Finalizado' : 'En Proceso'}
						</span>
					</div>

					${awardBadge}
				</div>

				<div class="p-5 flex flex-col flex-grow relative">
					<div class="absolute left-0 top-5 bottom-5 w-1 rounded-r ${theme.bg.replace('/50', '')} bg-opacity-100"></div>
					
					<div class="pl-3">
						<h3 class="text-base font-bold ${theme.text} leading-tight mb-2 line-clamp-3" title="${poster.titulo}">
							${poster.titulo}
						</h3>
						<p class="text-xs text-slate-500 font-medium mb-4 flex items-center gap-1">
							<svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>
							${poster.autor}
						</p>
					</div>

					<div class="mt-auto pl-3 pt-4 flex gap-2 border-t border-slate-50">
						${hasPdf ? `
							<button onclick="event.stopPropagation(); openPdfModal('${poster.pdfUrl}', '${poster.titulo}')" 
								class="flex-1 group flex justify-center items-center gap-2 px-3 py-2 text-xs font-semibold text-slate-600 bg-slate-50 hover:bg-indigo-50 hover:text-indigo-600 rounded-lg transition-colors border border-slate-100 hover:border-indigo-100">
								<svg class="w-4 h-4 text-slate-400 group-hover:text-indigo-500 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
								PDF
							</button>` : ''}
						
						${hasVideo ? `
							<button onclick="event.stopPropagation(); openVideoModal('${poster.videoUrl}', '${poster.titulo}')" 
								class="flex-1 group flex justify-center items-center gap-2 px-3 py-2 text-xs font-semibold text-slate-600 bg-slate-50 hover:bg-rose-50 hover:text-rose-600 rounded-lg transition-colors border border-slate-100 hover:border-rose-100">
								<svg class="w-4 h-4 text-slate-400 group-hover:text-rose-500 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
								Video
							</button>` : ''}
					</div>
				</div>
			`;
			return card;
		}

		function renderPosters(filterText = "") {
			completedGrid.innerHTML = '';
			developmentGrid.innerHTML = '';
			noResultsTerminados.classList.add('hidden');
			noResultsDesarrollo.classList.add('hidden');
			
			const normalizedFilter = filterText.toLowerCase().trim();
			let countTerminados = 0;
			let countDesarrollo = 0;

			posters.forEach(poster => {
				const titleMatch = poster.titulo.toLowerCase().includes(normalizedFilter);
				const authorMatch = poster.autor.toLowerCase().includes(normalizedFilter);
				
				if (titleMatch || authorMatch) {
					const card = createPosterCard(poster);
					if (poster.categoria === 'terminado') {
						completedGrid.appendChild(card);
						countTerminados++;
					} else {
						developmentGrid.appendChild(card);
						countDesarrollo++;
					}
				}
			});

			countTerminadosEl.textContent = `${countTerminados} proyecto${countTerminados !== 1 ? 's' : ''}`;
			countDesarrolloEl.textContent = `${countDesarrollo} proyecto${countDesarrollo !== 1 ? 's' : ''}`;

			if (countTerminados === 0) noResultsTerminados.classList.remove('hidden');
			if (countDesarrollo === 0) noResultsDesarrollo.classList.remove('hidden');
		}

		// --- Funciones Modales (Existentes) ---
		function openModal(imageUrl, title) {
			modalImage.src = imageUrl;
			modalTitle.textContent = title;
			modal.classList.remove('hidden');
			document.body.style.overflow = 'hidden';
			setTimeout(() => {
				modal.classList.remove('opacity-0');
				modal.querySelector('.modal-content').classList.remove('scale-95');
				modal.querySelector('.modal-content').classList.add('scale-100');
			}, 10);
		}

		function closeModal() {
			modal.classList.add('opacity-0');
			modal.querySelector('.modal-content').classList.remove('scale-100');
			modal.querySelector('.modal-content').classList.add('scale-95');
			setTimeout(() => {
				modal.classList.add('hidden');
				document.body.style.overflow = 'auto';
			}, 300);
		}

		function openPdfModal(pdfUrl, title) {
			const cleanPdfUrl = pdfUrl.includes('/view') ? pdfUrl.replace('/view', '/preview') : pdfUrl;
			pdfFrame.src = cleanPdfUrl;
			pdfModalTitle.textContent = title;
			pdfModal.classList.remove('hidden');
			document.body.style.overflow = 'hidden';
			setTimeout(() => {
				pdfModal.classList.remove('opacity-0');
				pdfModal.querySelector('.modal-content').classList.remove('scale-95');
				pdfModal.querySelector('.modal-content').classList.add('scale-100');
			}, 10);
		}

		function closePdfModal() {
			pdfModal.classList.add('opacity-0');
			pdfModal.querySelector('.modal-content').classList.remove('scale-100');
			pdfModal.querySelector('.modal-content').classList.add('scale-95');
			setTimeout(() => {
				pdfModal.classList.add('hidden');
				document.body.style.overflow = 'auto';
				pdfFrame.src = 'about:blank';
			}, 300);
		}

		function openVideoModal(videoUrl) {
			if(videoUrl && videoUrl !== '#') window.open(videoUrl, '_blank');
		}

		searchInput.addEventListener('input', (e) => renderPosters(e.target.value));
		
		window.openModal = openModal;
		window.closeModal = closeModal;
		window.openPdfModal = openPdfModal;
		window.closePdfModal = closePdfModal;
		window.openVideoModal = openVideoModal;

		renderPosters();

		// =================================================
		// === LOGICA DEL ZERG RUSH ELITE (GAME) ===
		// =================================================
		
		const MAX_ZERGLINGS = 9; // ELITE SQUAD
		let zerglings = [];
		let targets = [];
		let gameInterval;
		let spawnTimer;
		let difficultyTimer;
		
		// Variables de estado del juego
		let score = 0;
		let destroyed = 0;
		let gameActive = false;
		let gameEnded = false;
		let level = 1;
		
		// Variables de dificultad dinámica
		let spawnRate = 600; // Un poco más lento spawn porque son élites
		let zergSpeedBase = 3; // Velocidad base controlada (se ve rápido porque loop es 30ms)
		let zergHpChance = 0.1;

		// Footer Target Reference
		let footerTarget = null;

		// Matriz de letras para el final "COINSI" (Grid 5x7)
		const letterPatterns = {
			'C': [[1,0],[2,0],[3,0],[0,1],[0,2],[0,3],[0,4],[0,5],[1,6],[2,6],[3,6]],
			'O': [[1,0],[2,0],[3,0],[0,1],[4,1],[0,2],[4,2],[0,3],[4,3],[0,4],[4,4],[0,5],[4,5],[1,6],[2,6],[3,6]],
			'I': [[0,0],[1,0],[2,0],[1,1],[1,2],[1,3],[1,4],[1,5],[0,6],[1,6],[2,6]],
			'N': [[0,0],[0,1],[0,2],[0,3],[0,4],[0,5],[0,6],[1,2],[2,3],[3,4],[4,0],[4,1],[4,2],[4,3],[4,4],[4,5],[4,6]],
			'S': [[1,0],[2,0],[3,0],[0,1],[0,2],[1,3],[2,3],[3,3],[4,4],[4,5],[1,6],[2,6],[3,6]],
		};

		function startZergRush() {
			if (gameActive) return;
			gameActive = true;
			gameEnded = false;
			
			// Reiniciar variables
			level = 1;
			spawnRate = 600;
			zergSpeedBase = 3;
			zergHpChance = 0.1; 
			score = 0;
			destroyed = 0;
			zerglings.forEach(z => z.el.remove());
			zerglings = [];
			
			// UI Init
			document.getElementById('start-zerg-btn').style.display = 'none';
			const hud = document.getElementById('zerg-hud');
			hud.style.display = 'block';
			hud.classList.add('end-text-anim');
			document.getElementById('end-message').style.opacity = 0;
			
			// Identificar objetivos y encontrar el Footer (BOSS)
			targets = [];
			const elements = document.querySelectorAll('.target-element');
			elements.forEach(el => {
				if(el.offsetParent !== null) {
					// Restaurar visibilidad y opacidad
					el.style.visibility = 'visible';
					el.style.opacity = 1;
					
					const isFooter = el.id === 'main-footer';
					const t = {
						el: el,
						rect: el.getBoundingClientRect(),
						hp: isFooter ? 300 : 100, 
						originalOpacity: el.style.opacity || 1,
						isFooter: isFooter
					};
					targets.push(t);
					if (isFooter) footerTarget = t;
				}
			});

			// Loop principal (30ms)
			if (gameInterval) clearInterval(gameInterval);
			gameInterval = setInterval(updateGame, 30);
			
			// Iniciar spawns
			if (spawnTimer) clearTimeout(spawnTimer);
			scheduleNextSpawn();

			// Dificultad progresiva
			if (difficultyTimer) clearInterval(difficultyTimer);
			difficultyTimer = setInterval(increaseDifficulty, 5000);
			
			window.scrollTo({ top: 0, behavior: 'smooth' });
		}

		function increaseDifficulty() {
			if (!gameActive || gameEnded) return;
			level++;
			document.getElementById('level-val').textContent = level;

			// Más rápidos
			if (zergSpeedBase < 12) zergSpeedBase += 0.5;
			
			if (spawnRate > 200) spawnRate -= 50;
			
			if (level > 1 && zergHpChance < 0.8) zergHpChance += 0.1;

			const hud = document.getElementById('zerg-hud');
			hud.style.borderColor = '#ef4444';
			setTimeout(() => hud.style.borderColor = '#334155', 500);
		}

		function scheduleNextSpawn() {
			if (!gameActive || gameEnded) return;
			spawnZergling();
			spawnTimer = setTimeout(scheduleNextSpawn, spawnRate);
		}

		function spawnZergling() {
			if (zerglings.length >= MAX_ZERGLINGS) {
				document.getElementById('count-val').style.color = 'red';
				return; 
			} else {
				document.getElementById('count-val').style.color = 'white';
			}

			const zerg = document.createElement('div');
			
			let type = Math.random() > 0.5 ? 'type-r' : 'type-y';
			let maxHp = 3; // Base 3 clicks
			let size = 20;

			if (Math.random() < zergHpChance) {
				type = 'type-tank';
				maxHp = 8 + Math.floor(level); // Tanks son muy duros (8+)
				size = 30 + (maxHp); // Más grandes
				zerg.style.zIndex = 10000;
			}

			zerg.className = `zergling ${type}`;
			zerg.style.width = size + 'px';
			zerg.style.height = size + 'px';
			
			// --- SPAWN OMNIDIRECCIONAL ---
			let startX, startY;
            const edge = Math.floor(Math.random() * 4); // 0: Top, 1: Right, 2: Bottom, 3: Left
            const offset = 60;
            const vWidth = window.innerWidth;
            const vHeight = window.innerHeight;
            const scrollY = window.scrollY;

            switch(edge) {
                case 0: // Top
                    startX = Math.random() * vWidth;
                    startY = scrollY - offset;
                    break;
                case 1: // Right
                    startX = vWidth + offset;
                    startY = scrollY + (Math.random() * vHeight);
                    break;
                case 2: // Bottom
                    startX = Math.random() * vWidth;
                    startY = scrollY + vHeight + offset;
                    break;
                case 3: // Left
                    startX = -offset;
                    startY = scrollY + (Math.random() * vHeight);
                    break;
            }
			
			zerg.style.left = startX + 'px';
			zerg.style.top = startY + 'px';
			
			const enemyData = {
				el: zerg,
				x: startX,
				y: startY,
				speed: zergSpeedBase + (Math.random() * 1.5), 
				target: null,
				hp: maxHp,
				maxHp: maxHp,
				finalTargetX: null,
				finalTargetY: null
			};
			
			const hitHandler = (e) => { e.stopPropagation(); e.preventDefault(); hitZergling(enemyData); };
			zerg.addEventListener('mousedown', hitHandler);
			zerg.addEventListener('touchstart', hitHandler);
			
			document.body.appendChild(zerg);
			zerglings.push(enemyData);
			document.getElementById('count-val').textContent = zerglings.length;
		}

		function hitZergling(enemyData) {
			if (gameEnded) return;
			enemyData.hp--;
			enemyData.el.classList.add('hit');
			setTimeout(() => enemyData.el.classList.remove('hit'), 100);

			if (enemyData.hp <= 0) {
				const index = zerglings.indexOf(enemyData);
				if (index > -1) {
					enemyData.el.remove();
					zerglings.splice(index, 1);
					score += (50 * enemyData.maxHp); // Más puntos por enemigos duros
					document.getElementById('score-val').textContent = score;
					document.getElementById('count-val').textContent = zerglings.length;
				}
			} else {
				const currentSize = parseInt(enemyData.el.style.width);
				const newSize = currentSize * 0.92;
				enemyData.el.style.width = newSize + 'px';
				enemyData.el.style.height = newSize + 'px';
			}
		}

		function triggerGameEnd() {
			gameEnded = true;
			clearInterval(difficultyTimer);
			clearTimeout(spawnTimer);
			
			document.getElementById('zerg-hud').style.display = 'none';
			
			const msg = document.getElementById('end-message');
			msg.style.opacity = 1;
			msg.classList.add('end-text-anim');

			assignFinalPositions();
		}

		function assignFinalPositions() {
			const screenW = window.innerWidth;
			const screenH = window.innerHeight;
			
			// --- LÓGICA DE FORMACIÓN CENTRADA ---
			// Calculamos el centro de la pantalla (independiente del scroll) para el overlay fijo
			// Pero los zerglings son absolute, así que usamos coordenadas de página relativas al scroll actual
            const scrollY = window.scrollY;
			const centerY = scrollY + (window.innerHeight / 2);
			
            let gap = 14;
            let letterSpacing = 110;
            let zergSize = '12px';

            if (screenW < 800) {
                const safeWidth = screenW * 0.9;
                letterSpacing = safeWidth / 6; 
                gap = letterSpacing / 5; 
                zergSize = Math.max(4, gap * 0.8) + 'px';
            }

            // Ancho total estimado del grupo de letras
            const totalWidth = (5 * letterSpacing) + (2 * gap); 
            
			const startX = (screenW - totalWidth) / 2;
			
            // === POSICIONAMIENTO CRÍTICO: ARRIBA DEL TEXTO ===
            // El texto tiene un padding-top de 180px. Ponemos los círculos en ese espacio superior.
            // window.innerHeight / 2 es el centro. Subimos -100px o más.
            // Ajuste responsivo vertical
            const verticalOffset = screenW < 800 ? 120 : 150;
            const startY = centerY - verticalOffset; 

            zerglings.sort(() => Math.random() - 0.5);

            let totalPointsNeeded = 0;
            const word = ['C', 'O', 'I', 'N', 'S', 'I'];
            word.forEach(char => {
                totalPointsNeeded += letterPatterns[char].length;
            });

            if (zerglings.length < totalPointsNeeded) {
                const missing = totalPointsNeeded - zerglings.length;
                for(let i=0; i<missing; i++) {
                    spawnVisualZergling(screenW, centerY, zergSize);
                }
            }

			let zergIndex = 0;
			
			const vibrantColors = ['#fbbc05', '#ea4335', '#34a853', '#4285f4', '#a105fb', '#6366f1', '#ec4899', '#14b8a6'];

			word.forEach((char, charIdx) => {
				const pattern = letterPatterns[char];
				const letterOffsetX = charIdx * letterSpacing;

				pattern.forEach(pt => {
					if (zergIndex < zerglings.length) {
						const z = zerglings[zergIndex];
						z.finalTargetX = startX + letterOffsetX + (pt[0] * gap);
						z.finalTargetY = startY + (pt[1] * gap);
						
						const randomColor = vibrantColors[Math.floor(Math.random() * vibrantColors.length)];
						z.el.style.backgroundColor = randomColor; 
						z.el.style.borderColor = 'white';
                        z.el.style.opacity = 1;
						z.el.classList.remove('type-y', 'type-r', 'type-tank');
						z.el.classList.add('formation'); // Activar transición suave
                        z.el.style.width = zergSize;
                        z.el.style.height = zergSize;
						
						zergIndex++;
					}
				});
			});
			
			for(let i = zergIndex; i < zerglings.length; i++) {
				const angle = Math.random() * Math.PI * 2;
				const radius = Math.max(screenW, screenH);
				zerglings[i].finalTargetX = (screenW/2) + Math.cos(angle) * radius;
				zerglings[i].finalTargetY = centerY + Math.sin(angle) * radius;
				zerglings[i].el.classList.add('formation');
				zerglings[i].el.style.opacity = 0;
			}
		}

        function spawnVisualZergling(sw, sh, size) {
            const zerg = document.createElement('div');
            zerg.className = 'zergling formation'; // Ya nace listo para formarse
            zerg.style.width = size;
            zerg.style.height = size;
			
			const vibrantColors = ['#fbbc05', '#ea4335', '#34a853', '#4285f4', '#a105fb', '#6366f1', '#ec4899', '#14b8a6'];
            zerg.style.backgroundColor = vibrantColors[Math.floor(Math.random() * vibrantColors.length)];
            zerg.style.borderColor = 'white';
            
            // Aparecen desde fuera
            const angle = Math.random() * Math.PI * 2;
            const r = Math.max(sw, sh);
            const sx = (sw/2) + Math.cos(angle) * r;
            const sy = window.scrollY + (window.innerHeight/2) + Math.sin(angle) * r;

            zerg.style.left = sx + 'px';
            zerg.style.top = sy + 'px';
            
            document.body.appendChild(zerg);
            
            zerglings.push({
                el: zerg,
                x: sx,
                y: sy,
                speed: 0,
                hp: 1,
                finalTargetX: null,
                finalTargetY: null
            });
        }

		function updateGame() {
			if (gameEnded) {
				// En modo formación, usamos las transiciones CSS (clase .formation), 
				// pero necesitamos setear las coordenadas JS una última vez para que el CSS tome el control
				// O simplemente actualizar las props de estilo en el bucle para los nuevos
				zerglings.forEach(enemy => {
					if (enemy.finalTargetX !== null) {
						// Aplicamos coordenadas finales directas y dejamos que CSS transition haga la magia
						enemy.el.style.left = enemy.finalTargetX + 'px';
						enemy.el.style.top = enemy.finalTargetY + 'px';
					}
				});
				return;
			}

			targets = targets.filter(t => t.hp > 0);

			zerglings.forEach((enemy, index) => {
				// Limpieza si se salen muy lejos
				if (enemy.y > document.body.scrollHeight + 500 || enemy.y < -500 || enemy.x < -500 || enemy.x > window.innerWidth + 500) {
					if(!enemy.target) {
						enemy.el.remove();
						zerglings.splice(index, 1);
						return;
					}
				}

				if (!enemy.target || enemy.target.hp <= 0) {
					let minDist = Infinity;
					let closest = null;
					
					// SECUENCIAL ESTRICTO
					const hasNonFooterTargets = targets.some(t => !t.isFooter && t.hp > 0);
					
					targets.forEach(t => {
						if (hasNonFooterTargets && t.isFooter) return;

						const rect = t.el.getBoundingClientRect();
						const centerX = rect.left + rect.width / 2 + window.scrollX;
						const centerY = rect.top + rect.height / 2 + window.scrollY;
						const dist = Math.hypot(centerX - enemy.x, centerY - enemy.y);
						if (dist < minDist) {
							minDist = dist;
							closest = t;
						}
					});
					
					enemy.target = closest;
				}

				if (enemy.target) {
					const rect = enemy.target.el.getBoundingClientRect();
					const targetX = rect.left + rect.width / 2 + window.scrollX;
					const targetY = rect.top + rect.height / 2 + window.scrollY;

					const angle = Math.atan2(targetY - enemy.y, targetX - enemy.x);
					enemy.x += Math.cos(angle) * enemy.speed;
					enemy.y += Math.sin(angle) * enemy.speed;
					
					enemy.el.style.left = enemy.x + 'px';
					enemy.el.style.top = enemy.y + 'px';

					const dist = Math.hypot(targetX - enemy.x, targetY - enemy.y);
					
					if (dist < 50) { 
						enemy.target.hp -= 5; // Daño aumentado para compensar menos enemigos
						const maxHp = enemy.target.isFooter ? 300 : 100;
						enemy.target.el.style.opacity = enemy.target.hp / maxHp;
						
						if (enemy.target.hp <= 0) {
							enemy.target.el.style.visibility = 'hidden';
							destroyed++;
							
							if (enemy.target.isFooter) {
								triggerGameEnd();
							}
							
							enemy.target = null;
						}
					}
				} else {
					// Movimiento errático si no tienen target
					enemy.x += (Math.random() - 0.5) * 5;
					enemy.y += (Math.random() - 0.5) * 5;
					enemy.el.style.left = enemy.x + 'px';
					enemy.el.style.top = enemy.y + 'px';
				}
			});
		}
	</script>
</body>
</html>
